// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider        = "prisma-client-js"
  output          = "../generated/prisma"
  previewFeatures = ["clientExtensions"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
id Int @id @default(autoincrement())
  email     String    @unique
  name      String
  password  String
  role      String    @default("user")
  created_at DateTime  @default(now())
  updated_at DateTime @default(now())
}

model Pokemon {
  id      Int @id
  name    String @unique
  sprite_url String?
  cry_url String?

  abilities      PokemonAbility[]
  natures        PokemonNature[]
  stats          PokemonStat[]
  types          PokemonType[]
  egg_groups      PokemonEggGroup[]
  encounters     Encounter[]
  dex_numbers     PokemonDexNumber[]
  move        PokemonMove[]
}

model Ability {
  id          Int             @id
  name        String
  description String

  pokemon     PokemonAbility[]
}

model PokemonAbility {
  id         Int     @id
  pokemon_id Int
  ability_id Int
  is_hidden  Boolean

  pokemon Pokemon @relation(fields: [pokemon_id], references: [id])
  ability Ability @relation(fields: [ability_id], references: [id])
}

model Nature {
  id                Int       @id
  name              String
  increased_stat_id Int
  decreased_stat_id Int

  stat_increased     Stat      @relation("Nature-Increase", fields: [increased_stat_id], references: [id])
  stat_decreased     Stat      @relation("Nature-Decrease", fields: [decreased_stat_id], references: [id])

  pokemon           PokemonNature[]
}

model PokemonNature {
  id         Int   @id
  pokemon_id Int
  nature_id  Int

  pokemon Pokemon @relation(fields: [pokemon_id], references: [id])
  nature  Nature  @relation(fields: [nature_id], references: [id])
}

model Stat {
  id    Int    @id
  name  String

  natures_increase Nature[] @relation("Nature-Increase")
  natures_decrease Nature[] @relation("Nature-Decrease")

  pokemon_stats     PokemonStat[]
}

model PokemonStat {
  id         Int  @id
  pokemon_id Int
  stat_id    Int
  base_stat  Int

  pokemon Pokemon @relation(fields: [pokemon_id], references: [id])
  stat    Stat    @relation(fields: [stat_id], references: [id])
}

model Type {
  id            Int                @id
  name          String
  generation_id Int

  generation    Generation         @relation(fields: [generation_id], references: [id])

  pokemon       PokemonType[]
  attacking     TypeEffectiveness[] @relation("Type-Attack")
  defending     TypeEffectiveness[] @relation("Type-Defend")
  move Move[]
}

model TypeEffectiveness {
  id             Int   @id
  type_id        Int
  target_type_id Int
  damage_factor  Int

  attacker Type @relation("Type-Attack", fields: [type_id], references: [id])
  defender Type @relation("Type-Defend", fields: [target_type_id], references: [id])
}

model PokemonType {
  id         Int   @id
  pokemon_id Int
  type_id    Int

  pokemon Pokemon @relation(fields: [pokemon_id], references: [id])
  type    Type    @relation(fields: [type_id], references: [id])
}

model EggGroup{
  id Int @id
  name String

  pokemon_egg_group PokemonEggGroup[]
}

model PokemonEggGroup {
  id         Int   @id
  pokemon_id Int
  egg_group_id Int

  pokemon Pokemon @relation(fields: [pokemon_id], references: [id])
  egg_group EggGroup @relation(fields: [egg_group_id], references: [id])
}

model Region {
  id        Int                 @id
  name      String

  locations Location[]
  version_groups VersionGroupRegion[]
  generations Generation?
  pokedex Pokedex[]
}

model Generation {
  id        Int        @id
  name      String
  region_id Int @unique

  region    Region     @relation(fields: [region_id], references: [id])

  types     Type[]
  versionGroups VersionGroup[]
}

model VersionGroup {
  id            Int       @id
  name          String
  generation_id Int

  generation    Generation @relation(fields: [generation_id], references: [id])

  versions  Version[]
  regions   VersionGroupRegion[]
  slots     EncounterSlot[]
  moves     PokemonMove[]
  pokedex_version_groups PokedexVersionGroup[]
}

model VersionGroupRegion{
  id Int @id
  version_group_id Int
  region_id Int

  region Region @relation(fields:[region_id], references: [id])
  version_group VersionGroup @relation(fields: [version_group_id], references: [id])

}

model Version {
  id               Int    @id
  name             String
  version_group_id Int

  versionGroup     VersionGroup @relation(fields: [version_group_id], references: [id])

  encounters  Encounter[]
  encounterRates LocationAreaEncounterRate[]
}

model Location {
  id        Int       @id
  name      String
  region_id Int

  region    Region    @relation(fields: [region_id], references: [id])
  areas     LocationArea[]
}

model LocationArea {
  id        Int    @id
  name      String
  location_id Int

  location  Location @relation(fields: [location_id], references: [id])

  encounters   Encounter[]
  encounterRates LocationAreaEncounterRate[]
}

model EncounterMethod {
  id     Int   @id
  name   String

  slots  EncounterSlot[]
  location_area_encounter_rates LocationAreaEncounterRate[]
}

model EncounterSlot {
  id                Int   @id
  version_group_id  Int
  encounter_method_id Int
  slot              Int
  rarity            Int

  version_group VersionGroup @relation(fields: [version_group_id], references: [id])
  method       EncounterMethod @relation(fields: [encounter_method_id], references: [id])
  encounters   Encounter[]
}

model Encounter {
  id               Int   @id
  version_id       Int
  pokemon_id       Int
  location_area_id Int
  encounter_slot_id Int
  min_level        Int
  max_level        Int

  version       Version       @relation(fields: [version_id], references: [id])
  pokemon       Pokemon       @relation(fields: [pokemon_id], references: [id])
  location_area  LocationArea  @relation(fields: [location_area_id], references: [id])
  slot          EncounterSlot @relation(fields: [encounter_slot_id], references: [id])

  conditions    EncounterConditionValueMap[]
}

model EncounterCondition {
  id     Int   @id
  name   String

  values EncounterConditionValue[]
}

model EncounterConditionValue {
  id                     Int   @id
  encounter_condition_id Int
  name                   String
  is_default             Boolean

  condition EncounterCondition @relation(fields: [encounter_condition_id], references: [id])
  maps      EncounterConditionValueMap[]
}

model EncounterConditionValueMap {
  id                        Int   @id
  encounter_id              Int
  encounter_condition_value_id Int

  encounter Encounter @relation(fields: [encounter_id], references: [id])
  value     EncounterConditionValue @relation(fields: [encounter_condition_value_id], references: [id])
}

model LocationAreaEncounterRate{

    id Int @id
    location_area_id Int
    encounter_method_id Int
    version_id Int
    rate Int

    location_area LocationArea @relation(fields: [location_area_id], references: [id])
    encounter_method EncounterMethod @relation(fields: [encounter_method_id], references: [id])
    version Version @relation(fields: [version_id], references: [id])
}

model MoveDamageClass {
  id    Int    @id
  name  String

  moves Move[]
}

model MoveEffect {
  id          Int    @id
  description String
  moves       Move[]
}

model MoveMethod {
  id    Int   @id
  name  String

  moves PokemonMove[]
}

model Move {
  id              Int   @id
  name            String
  generation_id   Int
  type_id         Int
  pp              Int
  accuracy        Int?
  priority        Int
  move_damage_class_id Int
  move_effect_id       Int

  type          Type           @relation(fields: [type_id], references: [id])
  damage_class   MoveDamageClass @relation(fields: [move_damage_class_id], references: [id])
  effect        MoveEffect     @relation(fields: [move_effect_id], references: [id])

  pokemon_moves  PokemonMove[]
}

model PokemonMove {
  id                    Int @id
  version_group_id      Int
  move_method_id        Int
  move_id               Int
  pokemon_id Int
  level                 Int

  version_group VersionGroup @relation(fields: [version_group_id], references: [id])
  method       MoveMethod @relation(fields: [move_method_id], references: [id])
  move         Move        @relation(fields: [move_id], references: [id])
  pokemon         Pokemon        @relation(fields: [pokemon_id], references: [id])
}

model Pokedex {
  id Int @id
  name String
  region_id Int

  region Region @relation(fields: [region_id], references: [id])

  pokedex_version_groups PokedexVersionGroup[]
  pokemon_dex_numbers PokemonDexNumber[]
}

model PokedexVersionGroup {
  id Int @id
  version_group_id Int
  pokedex_id Int

  version_group VersionGroup @relation(fields: [version_group_id], references: [id])
  pokedex Pokedex @relation(fields: [pokedex_id], references: [id])
}

model PokemonDexNumber {
  id Int @id
  pokemon_id Int
  pokedex_id Int
  pokedex_number Int

  pokemon Pokemon @relation(fields: [pokemon_id], references: [id])
  pokedex Pokedex @relation(fields: [pokedex_id], references: [id])
}